<!--
  ~ * -----------------------------------------------------------------------------------------------
  ~ * "THE APPRECIATION LICENSE" (Revision 0x100):
  ~ * Copyright (c) 2016. M. Joosten
  ~ * You can do anything with this program and its code, even use it to run a nuclear reactor (why should you)
  ~ * But I won't be responsible for possible damage and mishap, because i never tested it on a nuclear reactor (why should I..)
  ~ * If you think this program/code is absolutely great and supercalifragilisticexpialidocious (or just plain useful), just
  ~ * let me know by sending me a nice email or postcard from your country of origin and leave this header in the code.
  ~ * Or better join my efforts to make this program even better :-)
  ~ * See my blog (http://joosten-industries/blog), for contact info
  ~ * ---------------------------------------------------------------------------------------------------
  ~
  ~
  -->

{% extends 'configuration.html' %}
{% load staticfiles %}


{% block main_content %}
    <h2>Sensor list</h2>


    <div class="table-responsive">
        <table class="table-bordered table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Category</th>
                <th>Type</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for sensor in sensor_list %}
                <tr>
                    <td>{{ sensor.name }}</td>
                    <td>{{ sensor.desc }}</td>
                    <td>{{ sensor.cat }}</td>
                    <td>{{ sensor.type }}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{% url 'sensor_details' sensor.name %}" class="btn btn-primary"><span
                                    class="glyphicon glyphicon-info-sign"></span> Details</a>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-warning"><span class="glyphicon glyphicon-edit"></span>
                                Edit
                            </button>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" id="delete_{{ sensor.name }}" class="btn btn-danger"><span
                                    class="glyphicon glyphicon-remove-sign"></span> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="btn-group btn-group-sm">
            <a href="{% url 'sensor_add' %}" type="button" class="btn btn-primary"><span
                    class="glyphicon glyphicon-plus-sign"></span> Add new</a>
        </div>
        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove-sign"></span> Clear all
            </button>
        </div>
    </div>


    <ul class="pagination">
        {% if sensor_list.has_previous %}
            <li><a href="{% url 'sensor_configuration' %}?page={{ sensor_list.previous_page_number }}">&laquo;</a></li>
        {% else %}
            <li class="disabled"><a href="#">&laquo;</a></li>
        {% endif %}

        {% for page_no in sensor_list.paginator.page_range %}
            {% if page_no == sensor_list.number %}
                <li class="active"><a href="#">{{ page_no }}</a></li>
            {% else %}
                <li><a href="{% url 'sensor_configuration' %}?page={{ page_no }}">{{ page_no }}</a></li>
            {% endif %}

        {% endfor %}

        {% if sensor_list.has_next %}
            <li><a href="{% url 'sensor_configuration' %}?page={{ sensor_list.next_page_number }}">&raquo;</a></li>
        {% else %}
            <li class="disabled"><a href="#">&raquo;</a></li>
        {% endif %}

    </ul>


    {% csrf_token %}
{% endblock %}

{% block additional_javascript %}

    <script type="application/javascript">
        $(document).ready(function () {
            $("button[id^='delete_']").click(function () {
                var buttonId = $(this).attr("id")
                var sensorName = buttonId.substr(buttonId.indexOf("_") + 1);

                url = "{% url 'sensor_delete'%}";
                var data = {
                    'sensor_name': sensorName
                }

                $.ajax(url, {
                    data: JSON.stringify(data),
                    type: "DELETE",
                    dataType: "json",
                    success: function (result) {
                        window.location = result.redirectUrl;
                    }
                });
            });
        });
    </script>
{% endblock %}